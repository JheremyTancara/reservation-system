import{r as i,a as oe,R as ae}from"./vendor-nf7bT_Uh.js";import{a as E}from"./axios-xsH4HHeE.js";(function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))f(c);new MutationObserver(c=>{for(const n of c)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&f(l)}).observe(document,{childList:!0,subtree:!0});function a(c){const n={};return c.integrity&&(n.integrity=c.integrity),c.referrerPolicy&&(n.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?n.credentials="include":c.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function f(c){if(c.ep)return;c.ep=!0;const n=a(c);fetch(c.href,n)}})();var L={exports:{}},C={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ne=i,le=Symbol.for("react.element"),ce=Symbol.for("react.fragment"),ie=Object.prototype.hasOwnProperty,de=ne.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,me={key:!0,ref:!0,__self:!0,__source:!0};function O(m,u,a){var f,c={},n=null,l=null;a!==void 0&&(n=""+a),u.key!==void 0&&(n=""+u.key),u.ref!==void 0&&(l=u.ref);for(f in u)ie.call(u,f)&&!me.hasOwnProperty(f)&&(c[f]=u[f]);if(m&&m.defaultProps)for(f in u=m.defaultProps,u)c[f]===void 0&&(c[f]=u[f]);return{$$typeof:le,type:m,key:n,ref:l,props:c,_owner:de.current}}C.Fragment=ce;C.jsx=O;C.jsxs=O;L.exports=C;var s=L.exports,A={},F=oe;A.createRoot=F.createRoot,A.hydrateRoot=F.hydrateRoot;const q="/chat-client/assets/fondo-dashboard-BIc8-e8Z.png",M="/chat-client/assets/logo-guss-BZ13qjIK.png",H="/chat-client/assets/pizza_dashboard-BE9-wVbA.jpg",U="/chat-client/assets/pizza_logo-BLM4ksoF.png",ue=({restaurant:m})=>{const[u,a]=i.useState([]),[f,c]=i.useState(""),[n,l]=i.useState(0),[x,b]=i.useState([]),[p,N]=i.useState(null),[P,w]=i.useState([]),[v,he]=i.useState([]),[xe,be]=i.useState(!1),[j,R]=i.useState(null),[ge,Q]=i.useState([]),[V,y]=i.useState({cliente_nombre:"",personas:"",fecha:"",hora:"",mesa_id:"",estado:"pendiente",branch_id:null}),[pe,B]=i.useState(!1),[ve,D]=i.useState(!1),[ye,we]=i.useState(!1),[je,W]=i.useState(null),[Se,Ne]=i.useState(!1),[z,G]=i.useState(!1),[Pe,K]=i.useState(!1),[$e,Ee]=i.useState(!1),k=window.location.port,$=k==="3002",g=`http://localhost:${k}/api`,_=["08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00"],Y=()=>{const e=new Date,r=new Date(e.getFullYear(),e.getMonth()+1,0).getDate(),t=[];for(let o=e.getDate();o<=r;o++)t.push(o);return t},Z=async e=>{try{console.log("Obteniendo mesas disponibles para branch:",e);const r=await E.get(`${g}/mesas?branch_id=${e}`);console.log("Respuesta de mesas disponibles:",r.data),r.data&&Array.isArray(r.data)?Q(r.data):(console.error("Formato de respuesta de mesas invÃ¡lido:",r.data),a(t=>[...t,{from:"bot",text:"Error al cargar las mesas disponibles. Por favor, intenta de nuevo."}]))}catch(r){console.error("Error al obtener mesas:",r),a(t=>[...t,{from:"bot",text:"Error al cargar las mesas disponibles. Por favor, intenta de nuevo."}])}};i.useEffect(()=>{console.log("[ChatBot] useEffect ejecutado"),console.log("[ChatBot] restaurant:",m),console.log("[ChatBot] API_BASE_URL:",g),m&&(async()=>{try{console.log("[ChatBot] Fetching sucursales from:",`${g}/branches`);const r=await E.get(`${g}/branches`);if(console.log("[ChatBot] Sucursales response:",r.data),!r.data||!Array.isArray(r.data)){a([{from:"bot",text:"Error al cargar las sucursales. Por favor, intenta de nuevo."}]);return}b(r.data);const t=`Bienvenido a ${m==null?void 0:m.name} ðŸ½ï¸. Â¿En quÃ© sucursal estÃ¡s interesado?`;a([{from:"bot",text:t}]),l(1)}catch(r){console.error("[ChatBot] Error al cargar sucursales:",r),a([{from:"bot",text:"Error al cargar las sucursales. Por favor, intenta de nuevo."}])}})()},[m,g]);const J=async e=>{c(e.nombre),await I(e.nombre)},X=()=>{if(v.length===0){a(o=>[...o,{from:"bot",text:"Por favor, selecciona al menos un plato antes de continuar."}]);return}const e=v.reduce((o,d)=>(o[d.nombre]||(o[d.nombre]={cantidad:0,precio:parseFloat(d.precio)||0,total:0}),o[d.nombre].cantidad+=1,o[d.nombre].total=o[d.nombre].cantidad*o[d.nombre].precio,o),{}),r=Object.entries(e).map(([o,d])=>`- ${o} x${d.cantidad}: Bs. ${Number(d.total).toFixed(2)}`).join(`
`),t=v.reduce((o,d)=>{const h=parseFloat(d.precio)||0;return o+h},0);a(o=>[...o,{from:"bot",text:`Perfecto! Tu pedido es:

${r}

Total: Bs. ${t.toFixed(2)}

Â¿Confirmas tu pedido?`}]),l(6)},T=e=>{const r=e.toLowerCase().trim(),t=h=>h.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9\s]/g,""),o=x.find(h=>t(h.nombre)===r||t(h.nombre).includes(r)||r.includes(t(h.nombre)));if(o)return o;const d=x.filter(h=>t(h.nombre).includes(r));return d.length===1?d[0]:(d.length>1&&R(d[0]),null)},ee=async()=>{try{const e={...V,platos:v.map(t=>({menu_item_id:t.id,nombre:t.nombre,precio:t.precio}))};console.log("Enviando reserva:",e);const r=await E.post(`${g}/reservas`,e);if(console.log("Respuesta de la reserva:",r.data),r.data&&r.data.id)W(r.data),a(t=>[...t,{from:"bot",text:`Â¡Excelente! Tu reserva ha sido creada exitosamente.

Reserva #${r.data.id}
Total: Bs. ${r.data.total||total.toFixed(2)}

Ahora necesitamos confirmar el pago. Â¿CÃ³mo deseas pagar?`}]),l(7);else throw new Error("No se recibiÃ³ ID de reserva")}catch(e){console.error("Error al guardar la reserva:",e),a(r=>[...r,{from:"bot",text:"Hubo un error al procesar tu reserva. Por favor, intenta de nuevo o contacta al restaurante."}])}},te=async e=>{const r=e.toLowerCase().trim();if(n===1){const t=T(e);t?(N(t),y(o=>({...o,branch_id:t.id})),a(o=>[...o,{from:"user",text:e},{from:"bot",text:`Perfecto! Has seleccionado ${t.nombre}. Ahora, Â¿quÃ© te gustarÃ­a hacer?

1. Ver el menÃº
2. Hacer una reserva`}]),l(2)):j?(a(o=>[...o,{from:"user",text:e},{from:"bot",text:`Â¿Te refieres a ${j.nombre}? Responde "sÃ­" para confirmar o "no" para buscar otra sucursal.`}]),l(1.5)):a(o=>[...o,{from:"user",text:e},{from:"bot",text:`No encontrÃ© la sucursal "${e}". Por favor, selecciona una de las siguientes:

${x.map((d,h)=>`${h+1}. ${d.nombre}`).join(`
`)}`}])}else if(n===1.5)r==="sÃ­"||r==="si"||r==="yes"?(N(j),y(t=>({...t,branch_id:j.id})),R(null),a(t=>[...t,{from:"user",text:e},{from:"bot",text:`Perfecto! Has seleccionado ${j.nombre}. Ahora, Â¿quÃ© te gustarÃ­a hacer?

1. Ver el menÃº
2. Hacer una reserva`}]),l(2)):(R(null),a(t=>[...t,{from:"user",text:e},{from:"bot",text:`Entendido. Por favor, selecciona una de las siguientes sucursales:

${x.map((o,d)=>`${d+1}. ${o.nombre}`).join(`
`)}`}]),l(1));else if(n===2)r==="1"||r.includes("menÃº")||r.includes("menu")?(a(t=>[...t,{from:"user",text:e},{from:"bot",text:"AquÃ­ tienes nuestro menÃº. Selecciona los platos que te gustarÃ­a ordenar:"}]),l(3),await re()):r==="2"||r.includes("reserva")?(a(t=>[...t,{from:"user",text:e},{from:"bot",text:"Perfecto! Vamos a hacer tu reserva. Primero, Â¿cuÃ¡l es tu nombre completo?"}]),l(4)):a(t=>[...t,{from:"user",text:e},{from:"bot",text:`Por favor, selecciona una opciÃ³n:

1. Ver el menÃº
2. Hacer una reserva`}]);else if(n===3)r==="confirmar"||r==="confirmo"?X():a(t=>[...t,{from:"user",text:e},{from:"bot",text:"Por favor, selecciona los platos haciendo clic en ellos y luego presiona 'Confirmar selecciÃ³n'."}]);else if(n===4)y(t=>({...t,cliente_nombre:e})),a(t=>[...t,{from:"user",text:e},{from:"bot",text:`Gracias ${e}! Â¿Para cuÃ¡ntas personas es la reserva?`}]),l(4.1);else if(n===4.1){const t=parseInt(e);if(isNaN(t)||t<1||t>20){a(o=>[...o,{from:"user",text:e},{from:"bot",text:"Por favor, ingresa un nÃºmero vÃ¡lido de personas (1-20)."}]);return}y(o=>({...o,personas:t})),a(o=>[...o,{from:"user",text:e},{from:"bot",text:"Perfecto! Â¿Para quÃ© fecha quieres la reserva? (dÃ­a del mes, por ejemplo: 15)"}]),l(4.2)}else if(n===4.2){const t=parseInt(e),o=Y();if(isNaN(t)||!o.includes(t)){a(S=>[...S,{from:"user",text:e},{from:"bot",text:`Por favor, ingresa un dÃ­a vÃ¡lido del mes actual (${o[0]}-${o[o.length-1]}).`}]);return}const d=new Date;d.setDate(t);const h=d.toISOString().split("T")[0];y(S=>({...S,fecha:h})),a(S=>[...S,{from:"user",text:e},{from:"bot",text:`Excelente! Â¿A quÃ© hora? AquÃ­ tienes los horarios disponibles:

${_.join(", ")}`}]),l(4.3)}else if(n===4.3){if(!_.includes(e)){a(t=>[...t,{from:"user",text:e},{from:"bot",text:`Por favor, selecciona un horario vÃ¡lido:

${_.join(", ")}`}]);return}y(t=>({...t,hora:e})),a(t=>[...t,{from:"user",text:e},{from:"bot",text:"Perfecto! Ahora vamos a verificar las mesas disponibles y crear tu reserva."}]),l(5),await Z(p.id),setTimeout(()=>{ee()},1e3)}else n===6?r==="sÃ­"||r==="si"||r==="confirmo"?(a(t=>[...t,{from:"user",text:e},{from:"bot",text:"Â¡Excelente! Tu pedido ha sido confirmado. Ahora vamos a procesar el pago."}]),l(7)):(a(t=>[...t,{from:"user",text:e},{from:"bot",text:"Entendido. Â¿Te gustarÃ­a modificar tu pedido o cancelar?"}]),l(3)):n===7?r.includes("qr")||r.includes("transferencia")?(a(t=>[...t,{from:"user",text:e},{from:"bot",text:"Perfecto! AquÃ­ tienes el cÃ³digo QR para realizar el pago:"}]),B(!0),D(!0),l(8)):r.includes("efectivo")||r.includes("cash")?(a(t=>[...t,{from:"user",text:e},{from:"bot",text:"Perfecto! Pago en efectivo. Tu reserva estÃ¡ confirmada. Â¿Necesitas algo mÃ¡s?"}]),l(9)):a(t=>[...t,{from:"user",text:e},{from:"bot",text:`Por favor, selecciona un mÃ©todo de pago:

- QR/Transferencia
- Efectivo`}]):n===8?r==="pagado"||r==="confirmo"?(D(!1),B(!1),a(t=>[...t,{from:"user",text:e},{from:"bot",text:"Â¡Excelente! Pago confirmado. Tu reserva estÃ¡ lista. Â¿Necesitas algo mÃ¡s?"}]),l(9)):a(t=>[...t,{from:"user",text:e},{from:"bot",text:"Por favor, confirma cuando hayas realizado el pago escribiendo 'pagado'."}]):n===9&&(r==="no"||r==="gracias"?(a(t=>[...t,{from:"user",text:e},{from:"bot",text:"Â¡Perfecto! Gracias por elegirnos. Tu reserva estÃ¡ confirmada. Â¡Que disfrutes tu comida! ðŸ½ï¸"}]),K(!0),G(!0)):a(t=>[...t,{from:"user",text:e},{from:"bot",text:"Â¿En quÃ© mÃ¡s puedo ayudarte?"}]))},re=async()=>{try{const e=await E.get(`${g}/menu`);w(e.data)}catch(e){console.error("Error al obtener el menÃº:",e),a(r=>[...r,{from:"bot",text:"Error al cargar el menÃº. Por favor, intenta de nuevo."}])}},I=async(e=f)=>{!e.trim()||z||(c(""),await te(e))},se=()=>{const e=`Hola! Tengo una consulta sobre mi reserva en ${(m==null?void 0:m.name)||"Guss Restobar"}.`,r=`https://wa.me/591777888999?text=${encodeURIComponent(e)}`;window.open(r,"_blank")};return s.jsx("div",{className:"min-h-screen w-full flex flex-col items-center justify-center",style:{backgroundImage:`url(${$?H:q})`,backgroundSize:"cover",backgroundPosition:"center"},children:s.jsxs("div",{className:"flex flex-col h-[80vh] w-full max-w-3xl mx-auto bg-white/80 rounded-lg shadow-lg mt-8 mb-8 p-0",children:[s.jsxs("div",{className:"w-full flex items-center justify-between bg-white/90 rounded-t-lg py-4 px-8 border-b",children:[s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsx("img",{src:$?U:M,alt:"Logo",className:"w-12 h-12"}),s.jsxs("div",{children:[s.jsx("h1",{className:`text-xl font-bold ${$?"text-red-700":"text-black"}`,children:m==null?void 0:m.name}),s.jsx("p",{className:"text-sm text-gray-700",children:"Sistema de Reservas y Chatbot"})]})]}),s.jsxs("button",{onClick:se,className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg flex items-center space-x-2",children:[s.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"})}),s.jsx("span",{children:"WhatsApp"})]})]}),s.jsx("div",{className:"flex-1 flex overflow-hidden",children:s.jsxs("div",{className:"flex-1 flex flex-col",children:[s.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-4",children:[u.map((e,r)=>s.jsx("div",{className:`flex ${e.from==="user"?"justify-end":"justify-start"}`,children:s.jsx("div",{className:`max-w-xs lg:max-w-md px-4 py-2 rounded-lg ${e.from==="user"?"bg-blue-500 text-white":"bg-white text-gray-900 border border-gray-200"}`,children:s.jsx("p",{className:"whitespace-pre-wrap",children:e.text})})},r)),n===1&&s.jsxs("div",{className:"bg-white/90 rounded-lg shadow-sm border p-4",children:[s.jsx("h3",{className:"text-lg font-semibold mb-4 text-black",children:"Sucursales disponibles"}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:x.map(e=>s.jsxs("div",{onClick:()=>J(e),className:"p-4 border border-gray-200 rounded-lg cursor-pointer hover:border-orange-400 hover:bg-orange-50 transition-colors",children:[s.jsx("h4",{className:"font-semibold text-gray-900",children:e.nombre}),e.telefono&&s.jsxs("p",{className:"text-sm text-gray-700",children:["Tel: ",e.telefono]}),e.direccion&&s.jsx("p",{className:"text-sm text-gray-700",children:e.direccion})]},e.id))})]})]}),!z&&s.jsx("div",{className:"border-t bg-white/90 p-4",children:s.jsxs("div",{className:"flex space-x-2",children:[s.jsx("input",{type:"text",value:f,onChange:e=>c(e.target.value),onKeyPress:e=>e.key==="Enter"&&I(),placeholder:"Escribe tu mensaje...",className:"flex-1 border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-orange-500 text-black"}),s.jsx("button",{onClick:()=>I(),className:`${$?"bg-red-600 hover:bg-red-700":"bg-orange-500 hover:bg-orange-600"} text-white px-6 py-2 rounded-lg`,children:"Enviar"})]})})]})})]})})};function fe(){const[m,u]=i.useState(null),[a,f]=i.useState(!0),[c,n]=i.useState(null),[l,x]=i.useState(!1),b=window.location.port,p=b==="3002";i.useEffect(()=>{N()},[]);const N=async()=>{try{f(!0);const P=`http://localhost:${b}/api`;let w=null;try{w=await(await fetch(`${P}/tenant/info`)).json()}catch{w={name:`Restaurante ${b}`,id:b}}u({...w,port:b,apiUrl:P})}catch{n("Error conectando con el restaurante")}finally{f(!1)}};return a?s.jsx("div",{className:"flex flex-col items-center justify-center min-h-screen bg-black/50",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-white mx-auto mb-4"}),s.jsx("p",{className:"text-white text-lg",children:"Conectando con el restaurante..."})]})}):c?s.jsx("div",{className:"flex flex-col items-center justify-center min-h-screen bg-black/50",children:s.jsxs("div",{className:"text-center bg-red-900/50 p-8 rounded-lg",children:[s.jsx("h2",{className:"text-white text-xl mb-4",children:"Error de ConexiÃ³n"}),s.jsx("p",{className:"text-white mb-4",children:c}),s.jsx("button",{onClick:()=>window.location.reload(),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded",children:"Reintentar"})]})}):m?s.jsx("div",{className:"min-h-screen w-full flex flex-col items-center justify-center",style:{backgroundImage:`url(${p?H:q})`,backgroundSize:"cover",backgroundPosition:"center"},children:s.jsxs("div",{className:"flex flex-col items-center justify-center w-full max-w-3xl mx-auto bg-white/80 rounded-lg shadow-lg mt-8 mb-8 p-0",children:[s.jsxs("div",{className:"w-full flex flex-col items-center justify-center bg-white/90 rounded-t-lg py-6 border-b",children:[s.jsx("img",{src:p?U:M,alt:"Logo",className:"w-16 h-16 mb-2"}),s.jsx("h1",{className:`text-2xl font-bold mb-1 ${p?"text-red-700":"text-orange-700"}`,children:m.name}),s.jsx("p",{className:"text-gray-600 text-sm",children:"Sistema de Reservas y Chatbot"})]}),!l&&s.jsx("div",{className:"w-full flex flex-col items-center justify-center py-12",children:s.jsx("button",{onClick:()=>x(!0),className:`px-8 py-4 rounded-lg text-xl font-bold shadow-lg transition text-white ${p?"bg-red-600 hover:bg-red-700":"bg-orange-500 hover:bg-orange-600"}`,children:"Empezar a chatear"})}),l&&s.jsx("div",{className:"w-full",children:s.jsx(ue,{restaurant:m})})]})}):null}A.createRoot(document.getElementById("root")).render(s.jsx(ae.StrictMode,{children:s.jsx(fe,{})}));
